(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1526:function(e,t,n){},1559:function(e,t,n){"use strict";n.r(t);n(18),n(35),n(36),n(26),n(27),n(28),n(113),n(122),n(134),n(41),n(39),n(43),n(32),n(44),n(104);var a=n(46),r=(n(69),n(19)),o=(n(103),n(48)),l=(n(133),n(23)),c=(n(143),n(488),n(22),n(65),n(388),n(0)),i=n.n(c),u=n(486),s=n(3),d=n(97),m=n(33),f=(n(200),n(85)),p=(n(224),n(123)),b=(n(848),n(390)),y=(n(174),n(72)),h=n(114),v=n.n(h),g=(n(58),n(507));function O(e,t){var n=e.form,a=e.setStepCur,r=e.actionData,u=n.getFieldDecorator,s=(n.validateFields,Object(c.useRef)(null)),d=function(){n.validateFields((function(e,t){if(!e){console.log("Received values of form: ",t);var n={deviceVersionName:t.deviceVersionName,filePath:t.filePath,totalVersion:t.totalVersion,extVersion:r.burnFileVersion,deviceVersionType:t.deviceVersionType,firmwareVersionType:"",mainVersion:"",deviceVersionId:""};a(1,n)}}))};Object(c.useImperativeHandle)(t,(function(){return{onFinish:d}}),[]);return i.a.createElement("div",{style:{padding:"0 100px"}},i.a.createElement(l.a,{labelCol:{span:8},wrapperCol:{span:16},className:"basic-params",colon:!1},i.a.createElement(l.a.Item,{label:"插件名称："},u("deviceVersionName",{rules:[{required:!0,whitespace:!0,message:"请输入插件名称"}]})(i.a.createElement(o.a,{maxLength:30}))),i.a.createElement(l.a.Item,{label:"插件编号："},i.a.createElement("span",null,"0")),i.a.createElement(l.a.Item,{label:"硬件版本号："},u("totalVersion",{})(i.a.createElement(o.a,null))),i.a.createElement(l.a.Item,{label:"当前软件版本号："},i.a.createElement("span",null,r.burnFileVersion)),i.a.createElement(l.a.Item,{label:"待上传软件版本号："},u("deviceVersionType",{rules:[{required:!0,message:"请输入待上传软件版本号"}]})(i.a.createElement(o.a,{maxLength:30}))),i.a.createElement(l.a.Item,{label:"固件程序："},u("filePath",{})(i.a.createElement(o.a,{placeholder:"请输入下载URL或者上传附件"}))),i.a.createElement(l.a.Item,{label:" "},u("filePath2",{})(i.a.createElement(g.a,{ref:s,maxCount:1,cb:function(){console.log(n.getFieldValue("filePath2")),n.setFieldsValue({filePath:n.getFieldValue("filePath2")[0].url})},format:".bin,.hex,.zip,.cyacd,.apk,.dpkg",isNotImg:!0,maxSize:200})))))}var E=l.a.create()(Object(c.forwardRef)(O)),w=(n(307),n(161));function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var N=[{title:"已使用模组的产品",dataIndex:"productName"},{title:"发布时间",dataIndex:"createTime",render:function(e){var t=e&&m.b.utcToDev(e);return i.a.createElement("span",null,t)}},{title:"创建账号",dataIndex:"contact"},{title:"联系号码",dataIndex:"tel"}];function T(e,t){var n=e.setStepCur,a=e.actionData,r=e.subObj,o=x(Object(c.useState)([]),2),l=o[0],u=o[1],d=x(Object(c.useState)([]),2),m=d[0],f=d[1],b=x(Object(c.useState)([]),2),y=b[0],h=b[1];Object(c.useEffect)((function(){(function(e){return s.c.request({url:"/manage-open/product/published/module",method:"post",data:e,headers:{}})})({moduleId:a.moduleId}).then((function(e){0===e.data.code&&u(e.data.data.list)}))}),[]);var v={onChange:function(e,t){console.log(e,"勾选的数据"),f(e),h(t)},selectedRowKeys:m},g=function(){m.length?function(e){return s.c.request({url:"/manage-open/firmware/device/version/addAll",method:"post",data:e,headers:{}})}(I(I({},r.one),{},{productIdList:m})).then((function(e){0===e.data.code?(p.a.success("升级成功"),n(2,y)):p.a.error("升级失败")})):p.a.info("请勾选数据")};return Object(c.useImperativeHandle)(t,(function(){return{onFinish:g}}),[m]),i.a.createElement("div",null,i.a.createElement(w.a,{rowKey:"productId",rowSelection:v,columns:N,dataSource:l}))}var k=l.a.create()(Object(c.forwardRef)(T)),P=o.a.TextArea;function A(e,t){var n=e.form,a=e.commitAll,r=n.getFieldDecorator,o=(Object(c.useRef)(null),function(){n.validateFields((function(e,t){e||a(t.textTemplate)}))});return Object(c.useImperativeHandle)(t,(function(){return{onFinish:o}}),[]),i.a.createElement("div",{style:{padding:"0 100px"}},i.a.createElement(l.a,{labelCol:{span:6},wrapperCol:{span:18},className:"basic-params"},i.a.createElement(l.a.Item,{label:"短信文案"},i.a.createElement("span",null,"短信通知")),i.a.createElement(l.a.Item,{label:"短信文案"},r("textTemplate",{})(i.a.createElement(P,{rows:4,readOnly:!0,placeholder:"尊敬的客户您好：clife平台已升级通信模组 {模组名称} ，您关联使用的产品 {产品名称}，可进行设备模组固件升级，敬请留意~"})))))}var R=l.a.create()(Object(c.forwardRef)(A));function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var F=y.a.TabPane,M=b.a.Step,J=["更新模组固件","选择产品对象","发送升级通知"];var q=function(e){var t=e.noticeVis,n=e.handleCancel,a=(e.handleOk,e.actionData),o=V(Object(c.useState)(0),2),l=o[0],u=o[1],d=Object(c.useRef)(),m=Object(c.useRef)(),h=Object(c.useRef)(),g=V(Object(c.useState)({one:{},two:{},three:{}}),2),O=g[0],w=g[1],j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;0===l?w((function(e){var n=v()(e);return n.one=v()(t),n})):1===l&&w((function(e){var n=v()(e);return n.two=v()(t),n})),u(e)};return i.a.createElement(f.a,{title:"更新通知",visible:t,onOk:function(){},onCancel:n,width:"800px",wrapClassName:"module-upgrade-notice",footer:[0!==l&&i.a.createElement(r.a,{key:"previous",onClick:function(){u(l-1)}},"上一步"),i.a.createElement(r.a,{type:"primary",key:"next",onClick:function(){0===l?d.current.onFinish():1===l?m.current.onFinish():2===l&&h.current.onFinish()}},2===l?"升级通知":"下一步")]},i.a.createElement("div",{className:"add-scheme-modal"},i.a.createElement("div",{className:"step-box "},i.a.createElement(b.a,{current:l},J.map((function(e,t){return i.a.createElement(M,{key:e,title:e})})))),i.a.createElement("div",{className:"formbox"},i.a.createElement(y.a,{activeKey:l+"",animated:!1},i.a.createElement(F,{tab:"基本参数",key:"0"},i.a.createElement(E,{setStepCur:j,wrappedComponentRef:d,actionData:a})),i.a.createElement(F,{tab:"功能参数",key:"1"},i.a.createElement(k,{setStepCur:j,subObj:O,wrappedComponentRef:m,actionData:a})),i.a.createElement(F,{tab:"功能参数",key:"2"},i.a.createElement(R,{wrappedComponentRef:h,actionData:a,commitAll:function(e){var t,r=O.two.map((function(e){return{productId:e.productId,productName:e.productName,contact:e.contact,tel:e.tel}})),o={textTemplate:"尊敬的客户您好：clife平台已升级通信模组 {模组名称} ，您关联使用的产品 {产品名称}，可进行设备模组固件升级，敬请留意~",version:O.one.deviceVersionType,hetModuleTypeName:a.moduleName,productDTOList:r};(t=o,s.c.request({url:"/manage-open/firmware/device/version/inform",method:"post",data:t,headers:{}})).then((function(e){0===e.data.code&&(p.a.success("操作成功"),n())}))}}))))))};n(1526);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){H(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var $=l.a.Item;t.default=l.a.create()((function(e){var t=e.form,n=t.getFieldDecorator,f=(t.validateFields,t.getFieldsValue),p=K(Object(c.useState)({pageIndex:1,pageRows:10}),2),b=p[0],y=p[1],h=K(Object(c.useState)(0),2),v=h[0],g=h[1],O=K(Object(c.useState)([]),2),E=O[0],w=O[1],j=K(Object(c.useState)(!1),2),I=j[0],S=j[1],x=K(Object(c.useState)(!1),2),C=x[0],N=x[1],T=K(Object(c.useState)({}),2),k=T[0],P=T[1],A=[{title:"模组型号",dataIndex:"hetModuleTypeName",key:"hetModuleTypeName",render:function(e){return i.a.createElement("span",{title:e},e)}},{title:"生产厂家",dataIndex:"brandName",key:"brandName",render:function(e){return i.a.createElement("span",{title:e},e)}},{title:"模组IC型号",dataIndex:"productName",key:"productName",render:function(e){return i.a.createElement("span",{title:e},e)}},{title:"模组尺寸",dataIndex:"schemeType",key:"schemeType",render:function(e,t){return i.a.createElement("span",null,t.sizeThickness,"*",t.sizeWidth,"*",t.sizeHeight,"mm")}},{title:"更新时间",dataIndex:"modifyTime",key:"modifyTime",render:function(e){var t=e&&m.b.utcToDev(e);return i.a.createElement("span",{title:t},t)}},{title:"操作",key:"",render:function(e,t){return i.a.createElement(i.a.Fragment,null,i.a.createElement("a",{onClick:function(){R(t)}},"更新通知"))}}],R=function(e){P(e),N(!0)};Object(c.useEffect)((function(){V()}),[b.pageRows,b.pageIndex]);var V=function(){var e={},t=f().hetModuleTypeName;t&&t.trim()&&(e.hetModuleTypeName=t.trim()),e=L(L({},e),b),S(!0),function(e){return s.c.request({url:"/manage-open/module/search",data:e,method:"post",headers:{}})}(e).then((function(e){0==e.data.code&&(w(e.data.data.list),g(e.data.data.pager.totalRows))})).finally((function(){S(!1)}))};return i.a.createElement("div",{className:"panelMn-page",style:{minWidth:"1200px"}},i.a.createElement(u.a,{title:"模组升级&通知"},i.a.createElement(l.a,{layout:"inline"},i.a.createElement($,{label:"关键字"},n("hetModuleTypeName",{})(i.a.createElement(o.a,{placeholder:"请输入生产厂商或模组型号",style:{width:240},allowClear:!0}))),i.a.createElement($,null,i.a.createElement(r.a,{type:"primary",onClick:function(){1==b.pageIndex?V():y({pageIndex:1,pageRows:10})}},"查询")),i.a.createElement($,null,i.a.createElement(r.a,{onClick:function(){t.resetFields()}},"重置")))),i.a.createElement(a.a,null,i.a.createElement(d.a,{rowKey:"moduleId",columns:A,dataSource:E,loading:I,pagination:{defaultCurrent:1,current:b.pageIndex,onChange:function(e,t){t===b.pageRows?y((function(n){var a=JSON.parse(JSON.stringify(n));return Object.assign(a,{pageIndex:e,pageRows:t})})):y((function(e){var n=JSON.parse(JSON.stringify(e));return Object.assign(n,{pageIndex:1,pageRows:t})}))},pageSize:b.pageRows,total:v,showQuickJumper:!0,showTotal:function(){return i.a.createElement("span",null,"共 ",i.a.createElement("a",null,v)," 条")}}})),C&&i.a.createElement(q,{noticeVis:C,handleCancel:function(){N(!1)},actionData:k}))}))}}]);