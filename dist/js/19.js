(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1507:function(e,t,a){},1523:function(e,t,a){"use strict";a.r(t),a.d(t,"Context",(function(){return se})),a.d(t,"default",(function(){return me}));a(37),a(18),a(34),a(41),a(33),a(42),a(35),a(21),a(36),a(27),a(29),a(30),a(221),a(256),a(850);var n=a(494),r=a(1393),o=a.n(r),i=(a(368),a(303),a(473),a(199),a(98),a(258),a(0)),l=a.n(i),c=(a(144),a(48)),u=(a(298),a(108)),d=(a(168),a(74),a(20)),s=(a(367),a(145)),m=(a(198),a(77)),p=(a(1394),a(1395)),f=(a(169),a(7)),y=(a(143),a(38)),v=(a(129),a(64)),h=(a(67),a(364),a(66),a(32)),I=a(3),b="/expert",E=function(e){return I.c.request({url:b+"/deviceType/deviceFunction/list/v2.0",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e})},g=function(e){var t={paged:!1,sceneId:e};return I.c.request({url:b+"/rule/list",method:"get",params:t,headers:{"Content-Type":"application/json"}})};function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}u.a.TabPane;var P=v.a.TextArea,w=y.a.Item,k={action:h.j,data:function(e){return{appId:31438,domainType:4}}};var j=y.a.create()((function(e){var t=e.form,a=t.getFieldDecorator,n=t.validateFields,r=(t.getFieldValue,t.getFieldsValue,t.setFieldsValue,Object(i.useContext)(se)),o=(r.state,r.dispatch),u=r.wholeScenceId,h=N(Object(i.useState)([]),2),E=h[0],g=h[1],O=N(Object(i.useState)([]),2),j=O[0],S=O[1],x=N(Object(i.useState)({}),2),V=(x[0],x[1],N(Object(i.useState)(""),2)),C=(V[0],V[1],N(Object(i.useState)([]),2)),D=C[0],q=C[1];Object(i.useEffect)((function(){I.c.request({url:b+"/scene/ai/getPageList/v2.0",method:"get",headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code&&g(e.data.data.list)}));var e;(e={paged:!1},I.c.request({url:b+"/scene/appInfo/list/v2.0",params:e,method:"get",headers:{"Content-Type":"application/json"}})).then((function(e){if(0==e.data.code){var t=e.data.data.map((function(e){return{label:e.appName,value:e.appId}}));S(t)}})),A()}),[]);var A=function(){var e;(e=u,I.c.request({url:b+"/scene/getDetail/v2.0?sceneId="+e,method:"get",headers:{"Content-Type":"application/json"}})).then((function(e){if(0==e.data.code){var a=e.data.data.scene,n=a.relSceneApps.map((function(e){return e.sceneId}));a.pictureUrl&&q([{url:a.pictureUrl,uid:1}]);var r={sceneName:a.sceneName,summary:a.summary,appIds:n};a.aiId&&(r.aiId=a.aiId),t.setFieldsValue(r),o({type:"saveWhole",payload:a})}}))};return l.a.createElement("div",null,l.a.createElement("div",{className:"content"},l.a.createElement("div",{className:"tab1"},l.a.createElement(y.a,{colon:!1},l.a.createElement(w,{label:"场景名称"},a("sceneName",{rules:[{required:!0,message:"请输入场景名称"}]})(l.a.createElement(v.a,{style:{width:"100%"}}))),l.a.createElement(w,{label:"场景描述"},a("summary",{})(l.a.createElement(P,{style:{width:"100%"}}))),l.a.createElement(w,{label:"场景图片"},a("pictureUrl",{getValueFromEvent:function(e){}})(l.a.createElement("div",null,l.a.createElement(p.a,T({className:"avatar-uploader"},k,{accept:".png,.jpg",onChange:function(e){e.file;var t=e.fileList;q(t)},listType:"picture-card",style:{width:"100px"},fileList:D,beforeUpload:function(e){return function(e,t){return new Promise((function(a,n){return t.indexOf(e.name.split(".").slice(-1)[0])>-1?a(!0):(message.error("只能上传".concat(t.join(","),"格式")),n(!1))}))}(e,["png","jpg"])}}),D.length?null:l.a.createElement("span",null,l.a.createElement(f.a,{type:"upload"})," 选择背景图"))))),l.a.createElement(w,{label:"关联AI能力"},a("aiId")(l.a.createElement(m.a,{allowClear:!0},E.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.aiId,value:e.aiId,label:e.aiName},e.aiName)}))))),l.a.createElement(w,{label:"关联APP"},a("appIds")(l.a.createElement(s.a.Group,{options:j}))),l.a.createElement("div",{className:"tab-btn"},l.a.createElement(d.a,{type:"primary",onClick:function(){n().then((function(e){for(var t in e)void 0===e[t]&&delete e[t],"appIds"===t&&(e.appIds=e.appIds.join(","));var a;D.length?e.pictureUrl=D[0].url||D[0].response.data.url:e.pictureUrl="",e.sceneId=u,(a=e,I.c.request({url:b+"/scene/addOrUpdate/v2.0",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:a})).then((function(t){0==t.data.code&&(c.a.success({message:"提示",description:"修改成功"}),o({type:"saveWhole",payload:e}))}))}))}},"保存"))))))})),S=(a(853),a(801)),x=(a(1398),a(1401)),V=(a(297),a(156)),C=(a(170),a(118),a(4)),D=a.n(C);function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}u.a.TabPane;var F=v.a.TextArea,R=y.a.Item,U=(v.a.Group,m.a.Option,[{label:"周一",value:"MON"},{label:"周二",value:"TUE"},{label:"周三",value:"WED"},{label:"周四",value:"THU"},{label:"周五",value:"FRI"},{label:"周六",value:"SAT"},{label:"周日",value:"SUN"}]),H=0;var M=y.a.create()((function(e){var t=e.form,a=t.getFieldDecorator,n=(t.validateFields,t.getFieldValue),r=t.getFieldsValue,u=t.setFieldsValue,p=t.resetFields,f=Object(i.useContext)(se),h=f.state,T=f.dispatch,N=f.wholeScenceId,O=q(Object(i.useState)({}),2),P=(O[0],O[1]),w=q(Object(i.useState)([]),2),k=w[0],j=w[1],C=q(Object(i.useState)([]),2),A=C[0],M=C[1],B=q(Object(i.useState)([]),2),J=B[0],_=B[1],$=q(Object(i.useState)([]),2),W=$[0],L=$[1],G=q(Object(i.useState)([]),2),K=(G[0],G[1],q(Object(i.useState)({}),2)),z=K[0],Q=K[1],X=q(Object(i.useState)(!1),2),Y=X[0],Z=X[1],ee=q(Object(i.useState)([]),2),te=ee[0],ae=ee[1],ne=q(Object(i.useState)(0),2),re=ne[0],oe=ne[1];Object(i.useEffect)((function(){var e,t;(e=1,I.c.request({url:b+"/combine/deviceType/option/v2.0?inoutTypeId="+e,method:"get",headers:{"Content-Type":"application/json"}})).then((function(e){0===e.data.code&&j(e.data.data)})),(t={inoutTypeId:2},I.c.request({url:b+"/combine/deviceType/action/v2.0",method:"get",headers:{"Content-Type":"application/json"},params:t})).then((function(e){0===e.data.code&&M(e.data.data)})),h.wholeInfo.aiId&&function(e){return I.c.request({url:b+"/scene/ai/getAiAbility/v2.0?aiId="+e,method:"get",headers:{"Content-Type":"application/json"}})}(h.wholeInfo.aiId).then((function(e){if(0===e.data.code){var t=e.data.data.aiOutParamList||[];t.unshift({key:"无"}),ae(t)}}))}),[]);var ie=function(){var e=r();if(console.log(e,"params======"),e.times=e.times||[],e.times.length&&e.ruleName){for(var t in e)void 0===e[t]&&delete e[t];var a;e.sceneId=N,e.enableTime=e.times.join(",")+";"+e.timer[0].format("HH:mm")+"-"+e.timer[1].format("HH:mm"),h.currentRule>0&&(e.ruleId=h.currentRule),(a=e,I.c.request({url:b+"/rule/addOrUpdate",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:a})).then((function(e){0==e.data.code&&g(N).then((function(t){h.currentRule>0?(c.a.success({message:"提示",description:"更新成功"}),T({type:"reRule",payload:t.data.data})):(c.a.success({message:"提示",description:"新增成功"}),T({type:"addReRule",payload:{list:t.data.data,id:e.data.data.ruleId}}))}))}))}else c.a.info({message:"提示",description:"信息不完善"})},le=function(){var e=r();if(1==h.formDom.data.conditionTypeId){var t=k.find((function(t){return t.conditionOptionId=e.conditionOptionId}));e.conditionOptionName=t.deviceTypeName,e.conditionExpression="";var a=J.find((function(t){return t.conditionId==e.conditionId}));e.conditionExpression=a.conditionName,a.operators.forEach((function(t){t.operatorId==e.operatorId&&(e.conditionExpression+=t.operatorCode)})),1==a.paramStyleId?e.conditionExpression+=e.conditionValue:a.queryParams.forEach((function(t){t.queryParamValue==e.conditionValue&&(e.conditionExpression+=t.queryParamName)}))}else{if(Y){return void T({type:"saveItem",payload:{conditionExpression:"是",conditionValue:"true",operatorId:1}})}e.conditionExpression="";var n=z;e.conditionExpression=n.conditionName,n.operators.forEach((function(t){t.operatorId==e.operatorId&&(e.conditionExpression+=t.operatorCode)})),1==n.paramStyleId?e.conditionExpression+=e.conditionValue:n.queryParams.forEach((function(t){t.queryParamValue==e.conditionValue&&(e.conditionExpression+=t.queryParamName)}))}T({type:"saveItem",payload:e})},ce=function(){var e=r(),t=e.names;if(t&&t.length){var a=[];t.filter((function(e){if(e)return e})).forEach((function(e,t){var n,r=W.find((function(t){return t.deviceFunctionId==e.deviceFunctionId}));1==r.paramStyleId||"无"!=e.light?n=r.functionParams[0].functionParamId:r.functionParams.forEach((function(t){t.functionParamValue==e.actionParamValue&&(n=t.functionParamId)})),"无"==e.light?a.push({actionParamValue:e.actionParamValue,deviceFunctionId:e.deviceFunctionId,functionParamId:n}):a.push({deviceFunctionId:e.deviceFunctionId,actionParamValue:"clifeai,"+h.wholeInfo.aiId+","+e.light,functionParamId:n})}));var n={delayTime:e.delayTime,deviceTypeId:e.deviceTypeId,factorIds:[],factorNames:[],ruleId:h.currentRule,sceneId:N,subSceneIndex:re,actionsItems:a};h.formDom.data.actionsId&&(n.actionsId=h.formDom.data.actionsId),function(e){return I.c.request({url:b+"/scene/actions/addOrUpdate",method:"post",headers:{"Content-Type":"application/json"},data:e})}(n).then((function(e){0==e.data.code&&(c.a.success({message:"提示",description:"更新设备动作成功"}),T({type:"saveActive"}))}))}else c.a.info({message:"提示",description:"至少填写一个功能点"})},ue=function(e){(function(e){return I.c.request({url:b+"/scene/condition/list/v2.0?conditionOptionId="+e,method:"get",headers:{"Content-Type":"application/json"}})})(e).then((function(e){0===e.data.code&&(e.data.data.forEach((function(e){1==e.queryParams.length&&e.queryParams[0].queryParamValue.indexOf(",")>-1&&(e.queryParams[0].queryParamValue=e.queryParams[0].queryParamValue.replace("(","["),e.queryParams[0].queryParamValue=e.queryParams[0].queryParamValue.replace(")","]"))})),_(e.data.data))}))};Object(i.useEffect)((function(){if(p(),H=0,h.currentRule&&"Node"===h.theme)if(1===h.formDom.nodeType)1!=h.formDom.data.conditionTypeId?((a=h.formDom.data.conditionOptionId,I.c.request({url:b+"/scene/condition/list/v2.0?conditionOptionId="+a,method:"get",headers:{"Content-Type":"application/json"}})).then((function(e){var t=e.data.data.find((function(e){return e.conditionId===h.formDom.data.conditionId}));Z(!e.data.data.length),Q(t)})),h.formDom.conditionExpression,u({operatorId:h.formDom.data.operatorId,conditionValue:h.formDom.data.conditionValue})):h.formDom.data.conditionExpression&&(ue(h.formDom.data.conditionOptionId),u({conditionOptionId:h.formDom.data.conditionOptionId,conditionId:h.formDom.data.conditionId,operatorId:h.formDom.data.operatorId,conditionValue:h.formDom.data.conditionValue}));else if(3===h.formDom.nodeType&&h.formDom.data.actionsId){var e=[],t=[];h.formDom.data.actionsItems.forEach((function(a){H++,e.push({unlkey:H}),a.actionParamValue.indexOf("clifeai,")>-1?t.push({deviceFunctionId:a.deviceFunctionId,light:a.actionParamValue.split(",")[2],unlkey:H}):t.push({deviceFunctionId:a.deviceFunctionId,actionParamValue:a.actionParamValue,unlkey:H})})),me(h.formDom.data.deviceTypeId),u({deviceTypeId:h.formDom.data.deviceTypeId,delayTime:h.formDom.data.delayTime,keys:t})}var a;h.currentRule>0&&"Tab"===h.theme&&-1===h.activePropsId&&de()}),[h.activePropsId]),Object(i.useEffect)((function(){p(),h.currentRule>0&&"Tab"===h.theme&&de(),h.currentRule>0&&h.pannelTab.forEach((function(e,t){e.ruleId==h.currentRule&&oe(t)}))}),[h.currentRule]);var de=function(){var e;(e=h.currentRule,I.c.request({url:b+"/rule/getDetail?ruleId="+e,method:"get",headers:{"Content-Type":"application/json"}})).then((function(e){if(0==e.data.code){P(e.data.data);var t=e.data.data||{},a=t.enableTime.split(";")[0].split(","),n=t.enableTime.split(";")[1];u({ruleName:t.ruleName,summary:t.summary,times:a,timer:n})}}))},me=function(e){E({deviceTypeId:e}).then((function(e){L(e.data.data)}))},pe=function(e){E({deviceTypeId:e}).then((function(e){L(e.data.data)})),u({keys:[]})},fe=function(){var e=t.getFieldValue("keys");if(e&&e.length>4)V.a.info("最多添加5个");else{H++;var a=e.concat({unlkey:H});t.setFieldsValue({keys:a})}},ye=function(){return a("keys",{initialValue:[]}),n("keys").map((function(e,r){return l.a.createElement("div",{key:e.unlkey,className:"function-item-wrap"},l.a.createElement("div",{className:"title"},l.a.createElement("div",null,"选择功能点"),l.a.createElement("a",{onClick:function(){!function(e){var a=t.getFieldValue("keys");t.setFieldsValue({keys:a.filter((function(t){return t.unlkey!==e}))})}(e.unlkey)}},"删除")),l.a.createElement(y.a.Item,{label:"功能字段"},a("names[".concat(e.unlkey,"].deviceFunctionId"),{initialValue:e.deviceFunctionId?e.deviceFunctionId+"":""})(l.a.createElement(m.a,{onChange:function(){var t,a;t="names[".concat(e.unlkey,"].actionParamValue"),(a={})[t]="",u(a)}},W.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.deviceFunctionId,value:e.deviceFunctionId+"",label:e.deviceFunctionName},e.deviceFunctionName)}))))),l.a.createElement(y.a.Item,{label:"AI字段"},a("names[".concat(e.unlkey,"].light"),{initialValue:e.light?e.light+"":"无"})(l.a.createElement(m.a,null,te.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.key,value:e.key,label:e.key},e.key)}))))),l.a.createElement(y.a.Item,{label:"功能参数",style:{display:"无"!=n("names[".concat(e.unlkey,"].light"))?"none":"block"}},a("names[".concat(e.unlkey,"].actionParamValue"),{initialValue:e.actionParamValue?e.actionParamValue+"":""})((o=W.find((function(t){return t.deviceFunctionId==n("names[".concat(e.unlkey,"].deviceFunctionId"))})),console.log(o,"===data",n("names[".concat(e.unlkey,"].light"))),o=o||{},"无"!=n("names[".concat(e.unlkey,"].light"))&&(o={}),o.paramStyleId=o.paramStyleId||1,o.functionParams=o.functionParams||[],1===o.paramStyleId?l.a.createElement(x.a,{min:o.functionParams.length&&JSON.parse(o.functionParams[0].functionParamValue)[0],max:o.functionParams.length&&JSON.parse(o.functionParams[0].functionParamValue)[1],style:{width:"100%"}}):l.a.createElement(m.a,null,o.functionParams.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.functionParamValue,value:e.functionParamValue,label:e.functionParamName},e.functionParamName)})))))));var o}))},ve=function(){return a("operatorId",{}),a("conditionValue",{}),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"props-title"},l.a.createElement("img",null)," 设备触发"),l.a.createElement("div",null,"请选择您的产品来完成对设备触发条件的设置"),l.a.createElement(y.a.Item,{label:"选择产品"},a("conditionOptionId",{})(l.a.createElement(m.a,{onChange:ue},k.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.conditionOptionId,value:e.conditionOptionId,label:e.deviceTypeName},e.deviceTypeName)}))))),l.a.createElement(y.a.Item,{label:"选择功能点",style:{marginBottom:"10px"}},l.a.createElement("span",{style:{display:"inline-block",width:"70px"}},"功能字段"),l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(100% - 70px)"}},a("conditionId",{})(l.a.createElement(m.a,{onChange:function(){u({operatorId:"",conditionValue:""})}},J.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.conditionId,value:e.conditionId,label:e.conditionName},e.conditionName)})))))),function(){a("operatorId",{}),a("conditionValue",{});var e=J.find((function(e){return e.conditionId==n("conditionId")}));return(e=e||{}).operators=e.operators||[],e.paramStyleId=e.paramStyleId||1,e.queryParams=e.queryParams||[],l.a.createElement(y.a.Item,{style:{marginBottom:0}},l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("operatorId",{})(l.a.createElement(m.a,null,e.operators.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.operatorId,value:e.operatorId,label:e.operatorName},e.operatorName)}))))),l.a.createElement("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},"-"),l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("conditionValue")(1==e.paramStyleId?l.a.createElement(x.a,{min:e.queryParams.length&&JSON.parse(e.queryParams[0].queryParamValue)[0],max:e.queryParams.length&&JSON.parse(e.queryParams[0].queryParamValue)[1],style:{width:"100%"}}):l.a.createElement(m.a,null,e.queryParams.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.queryParamValue,value:e.queryParamValue,label:e.queryParamName},e.queryParamName)}))))))}())};return l.a.createElement("div",null,l.a.createElement("div",{className:"content"},l.a.createElement("div",{className:"tab1"},l.a.createElement(y.a,{colon:!1},function(){if("Tab"===h.theme)return l.a.createElement(l.a.Fragment,null,l.a.createElement(R,{label:"规则名称"},a("ruleName",{rules:[{required:!0,message:"场景名称"}]})(l.a.createElement(v.a,{style:{width:"100%"}}))),l.a.createElement(R,{label:"规则描述描述"},a("summary",{})(l.a.createElement(F,{style:{width:"100%"}}))),l.a.createElement(R,{label:"生效日期"},a("times",{initialValue:["TUE","MON","WED","FRI","THU","SAT","SUN"]})(l.a.createElement(s.a.Group,{options:U}))),l.a.createElement(R,{label:"生效时间"},l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("timer.0",{initialValue:D()("00:00","HH:mm")})(l.a.createElement(S.a,{format:"HH:mm",allowClear:!1}))),l.a.createElement("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},"-"),l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("timer.1",{initialValue:D()("23:59","HH:mm")})(l.a.createElement(S.a,{format:"HH:mm",allowClear:!1})))));if("Node"===h.theme){if(1===h.formDom.nodeType)return 1!=h.formDom.data.conditionTypeId?function(){a("operatorId",{}),a("conditionValue",{});var e=o()(z);return(e=e||{}).operators=e.operators||[],e.paramStyleId=e.paramStyleId||1,e.queryParams=e.queryParams||[],l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"props-title",style:{display:Y?"block":"none"}},l.a.createElement("img",null)," ",h.formDom.data.conditionName),l.a.createElement("div",{style:{display:Y?"none":"block"}},l.a.createElement("div",{className:"props-title"},l.a.createElement("img",null)," ",e.conditionName),l.a.createElement(y.a.Item,{label:"设置".concat(e.conditionName),style:{marginBottom:0}},l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("operatorId",{})(l.a.createElement(m.a,null,e.operators.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.operatorId,value:e.operatorId,label:e.operatorName},e.operatorName)}))))),l.a.createElement("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},"-"),l.a.createElement(y.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},a("conditionValue")(1==e.paramStyleId?l.a.createElement(x.a,{min:e.queryParams.length&&JSON.parse(e.queryParams[0].queryParamValue)[0],max:e.queryParams.length&&JSON.parse(e.queryParams[0].queryParamValue)[1]}):l.a.createElement(m.a,null,e.queryParams.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.queryParamValue,value:e.queryParamValue,label:e.queryParamName},e.queryParamName)}))))))))}():ve();if(3===h.formDom.nodeType)return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"props-title"},l.a.createElement("img",null)," 设备动作"),l.a.createElement("div",null,"请选择您的产品来完成对设备动作条件的设置"),l.a.createElement(y.a.Item,{label:"选择产品"},a("deviceTypeId",{})(l.a.createElement(m.a,{onChange:pe},A.map((function(e,t){return l.a.createElement(m.a.Option,{key:e.deviceTypeId,value:e.deviceTypeId,label:e.deviceTypeName},e.deviceTypeName)}))))),ye(),l.a.createElement("a",{onClick:fe,className:"add-btn"},"新增"),l.a.createElement(y.a.Item,{label:"延时设置"},a("delayTime",{})(l.a.createElement(x.a,{style:{width:"100%"}}))));if(2===h.formDom.nodeType)return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"props-title"},l.a.createElement("img",null)," ",h.activePropsId),l.a.createElement("div",null,"AND"===h.activePropsId?"逻辑与，当此功能条件左连接的多个触发条件同时满足的时候，会触发此功能条件右连接的动作动作":"逻辑或，当此功能条件左连接的多个触发条件满足任意一个的时候，会触发此功能条件右连接的动作动作。"))}}(),l.a.createElement("div",{className:"tab-btn"},l.a.createElement(d.a,{type:"primary",onClick:function(){"Tab"===h.theme?ie():"Node"===h.theme&&(1===h.formDom.nodeType?le():3===h.formDom.nodeType&&ce())}},"保存"))))))})),B=u.a.TabPane;function J(){var e=Object(i.useContext)(se),t=e.state,a=e.dispatch,n=function(e){t.showTab!==e&&(t.pannelTab.length?a({type:"changeTab",payload:e}):c.a.info({message:"提示",description:"先添加规则"}))};return l.a.createElement("div",{className:"rule-right"},l.a.createElement(u.a,{renderTabBar:function(){return l.a.createElement("div",{className:"rule-title rule-title-right"},l.a.createElement("div",{className:"1"===t.showTab?"active-tab":"",onClick:function(){n("1")}},"全局属性"),l.a.createElement("div",{className:"2"===t.showTab?"active-tab":"",onClick:function(){n("2")}},"属性"))},activeKey:t.showTab},l.a.createElement(B,{tab:"Tab 1",key:"1"},l.a.createElement("div",{className:"content"},l.a.createElement(j,null))),l.a.createElement(B,{tab:"Tab 2",key:"2"},l.a.createElement("div",{className:"content"},l.a.createElement(M,null)))))}a(369);var _=a(185);a(827),a(44);function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var G=_.a.TreeNode,K=function(e){var t=e.treeData,a=void 0===t?[]:t,n=e.tabType,r=Object(i.useContext)(se),o=r.state,u=r.dispatch,d=W(Object(i.useState)(!1),2),s=d[0],m=d[1],p=W(Object(i.useState)([]),2),f=p[0],y=p[1];return l.a.createElement("div",{className:"rule-tree-item"},l.a.createElement(_.a,{showIcon:!0,autoExpandParent:s,onExpand:function(e){y(e),m(!1)},expandedKeys:f,blockNode:!0},function e(t){return t.map((function(t){return t.children?l.a.createElement(G,{title:l.a.createElement("span",null,t.title),key:t.key,dataRef:t},e(t.children)):l.a.createElement(G,$({key:t.key},t,{title:l.a.createElement("span",{onDoubleClick:function(){var e;e=t,!o.pannelTab.length||o.currentRule<1?c.a.info({message:"提示",description:"先选择规则"}):u({type:"addNode",payload:{nodeType:n,nodeInfo:e}})}},t.title),className:o.propsId==t.key.split("-")[1]?"active-tree":""}))}))}(a)))};function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var X=v.a.Search,Y=(_.a.TreeNode,function(e){var t=Object(i.useContext)(se),a=(t.state,t.dispatch,z(Object(i.useState)([]),2)),n=a[0],r=a[1],c=z(Object(i.useState)([]),2),u=c[0],d=c[1],s=Object(i.useMemo)((function(){return[{title:"逻辑符",key:"1-0",children:[{title:"AND",key:"2-and"},{title:"OR",key:"2-or"}]}]}),[]),m=Object(i.useMemo)((function(){return[{title:"设备",key:"1-0",children:[{title:"设备动作",key:"2-active"}]}]}),[]),p=z(Object(i.useState)(""),2),f=p[0],y=p[1],v=function(){I.c.request({url:b+"/combine/menus/v2.0",method:"get",headers:{"Content-Type":"application/json"}}).then((function(e){if(0===e.data.code){var t=e.data.data.map((function(t,a){var n={};return t.conditionOptions[0].conditions=t.conditionOptions[0].conditions||[],e.data.data.length===a+1&&(t.conditionOptions[0].conditions=[{conditionId:1,conditionName:"设备触发",conditionTypeId:1}],t.conditionOptions[0].conditionOptionId=1),n.children=t.conditionOptions[0].conditions,n.key="1-"+t.conditionTypeId,n.title=t.conditionTypeName,t.conditionOptions[0].conditions.forEach((function(e){e.key="2-"+e.conditionId+"-"+t.conditionOptions[0].conditionOptionId,e.title=e.conditionName,e.conditionOptionId=t.conditionOptions[0].conditionOptionId,e.conditionTypeName=t.conditionTypeName})),n}));r(t),d(t)}}))};Object(i.useEffect)((function(){v()}),[]);return l.a.createElement("div",{className:"rule-left"},l.a.createElement("div",{className:"rule-title"},l.a.createElement(X,{placeholder:"请输入内容",className:"searchBox",value:f,onSearch:function(e){var t=o()(u);if(e&&e.trim()){var a=[];t.forEach((function(t){if(t.children&&t.children.length){var n=o()(t);n.children=[],t.children.forEach((function(t){t.title.indexOf(e)>-1&&n.children.push(t)})),a.push(n)}})),r(a),console.log(a,"过滤数据===")}else r(t)},onChange:function(e){y(e.target.value)},allowClear:!0})),l.a.createElement("div",null,l.a.createElement("div",null,l.a.createElement("h1",null,"触发条件"),l.a.createElement(K,{treeData:n,tabType:1})),l.a.createElement("div",null,l.a.createElement("h1",null,"功能节点"),l.a.createElement(K,{treeData:s,tabType:2})),l.a.createElement("div",null,l.a.createElement("h1",null,"动作动作"),l.a.createElement(K,{treeData:m,tabType:3}))))}),Z=(a(372),a(244)),ee=(a(371),a(113));function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ae(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}u.a.TabPane;function ne(){var e=Object(i.useContext)(se),t=e.state,a=e.dispatch,n=e.wholeScenceId,r=te(Object(i.useState)([]),2),u=r[0],d=r[1],s=te(Object(i.useState)([]),2),m=s[0],p=s[1],y=te(Object(i.useState)([]),2),v=y[0],h=y[1],E=te(Object(i.useState)(0),2),g=E[0],T=E[1],N=te(Object(i.useState)(!1),2),O=(N[0],N[1],function(e,n){n.stopPropagation(),t.pannelTab.findIndex((function(e){if(e.ruleId<0)return!0}))>-1?c.a.info({message:"提示",description:"先完成当前新增规则"}):e!=t.currentRule&&a({type:"translateTab",payload:e})}),P=function(e,n,r,o){o.stopPropagation(),t.activePropsId==e.conditionId+"_"+r&&1==n||t.activePropsId==e.actionsId+"_"+r&&3==n||t.activePropsId==e.title+"_"+r&&2==n||a({type:"clickNode",payload:{data:e,nodeType:n,index:r}})},w=function(e,t){t.stopPropagation(),h((function(t){var a=o()(t);return a.splice(e,1),a})),a({type:"overViewRule"})},k=function(e){e.stopPropagation(),p([])},j=function(e,t,n){if(n.stopPropagation(),!e.actionsId)return d((function(e){var a=o()(e);return a.splice(t,1),a})),void a({type:"overViewRule"});(function(e){return I.c.request({url:b+"/scene/actions/delete",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e})})({actionsId:e.actionsId}).then((function(e){0==e.data.code&&(d((function(e){var a=o()(e);return a.splice(t,1),a})),a({type:"overViewRule"}),c.a.success({message:"提示",description:"删除成功"}))}))};Object(i.useEffect)((function(){var e;(d([]),p([]),h([]),t.currentRule>0)&&(t.pannelTab.forEach((function(a,n){a.ruleId==t.currentRule&&(e=n,T(n))})),S(e),x(e))}),[t.currentRule]);Object(i.useEffect)((function(){if("addNode"===t.currentEvent){if(!(e=v.findIndex((function(e){if(void 0===e.operatorId)return!0})),n=u.findIndex((function(e){if(void 0===e.actionsId)return!0})),r=t.pannelTab.findIndex((function(e){if(e.ruleId<0)return!0})),!(e>-1||n>-1||r>-1)))return c.a.info({message:"提示",description:"有未完善数据"}),void a({type:"callBackEvent"});1==t.nodeInfo.nodeType?h((function(e){var a=o()(e);return a.push(t.nodeInfo.nodeInfo),a})):2==t.nodeInfo.nodeType?p([t.nodeInfo.nodeInfo]):3==t.nodeInfo.nodeType&&d((function(e){var a=o()(e);return a.push(t.nodeInfo.nodeInfo),a}))}else"saveNode"===t.currentEvent?1==t.formDom.nodeType&&h((function(e){var a=o()(e);return a.splice(t.formDom.index,1,t.formDom.data),a})):"reFreshNode"===t.currentEvent&&S();var e,n,r;a({type:"callBackEvent"})}),[t.currentEvent]);var S=function(e){var t;"number"!=typeof e&&(e=g),(t={sceneId:n,subSceneIndex:e},I.c.request({url:b+"/scene/actions/list",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t})).then((function(e){0==e.data.code&&d(e.data.data)}))},x=function(e){"number"!=typeof e&&(e=g),function(e){return I.c.request({url:b+"/scene/condition/instance/list/v2.0",method:"get",params:e,headers:{"Content-Type":"application/json"}})}({sceneId:n,subSceneIndex:e}).then((function(e){0==e.data.code&&(h(e.data.data),e.data.data.length&&e.data.data.length>1&&("&&"===e.data.data[0].suffix?p([{title:"AND",key:"2-and"}]):p([{title:"OR",key:"2-or"}])))}))},V=function(e){if(e.stopPropagation(),v.length){var a=[];if(v.length>1&&0===m.length&&0===m.length)return void c.a.info({message:"提示",description:"请选择逻辑符"});var r=(new Date).getTime(),o=0;v.forEach((function(e,i){o++;var l={conditionId:e.conditionId,conditionValue:e.conditionValue,conditionIndex:i,ruleId:t.currentRule,sceneId:n,operatorId:e.operatorId,equivalentConditionId:r+o,subSceneIndex:g};i+1!==v.length&&v.length>1&&(l.suffix="AND"==m[0].title?"&&":"||"),e.deviceTypeId&&(l.deviceTypeId=e.deviceTypeId),a.push(l)})),(i=a,I.c.request({url:b+"/scene/condition/instance/addOrUpdate/v2.0",method:"post",headers:{"Content-Type":"application/json"},data:i})).then((function(e){0==e.data.code&&c.a.success({message:"提示",description:"保存成功"})}))}else if(0===m.length)return void c.a.info({message:"提示",description:"没有需要保存的数据"});var i},C=function(e,n){n.stopPropagation();var r,o=t.pannelTab.findIndex((function(t){return t.ruleId==e}));e>0?(r={ruleId:e},I.c.request({url:b+"/rule/delete",method:"post",needFormData:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:r})).then((function(n){0==n.data.code&&(c.a.success({message:"提示",description:"删除成功"}),a({type:"delRule",payload:{index:o,isSame:e==t.currentRule}}))})):(c.a.success({message:"提示",description:"删除成功"}),a({type:"delRule",payload:{index:o,isSame:e==t.currentRule}}))};return l.a.createElement("div",{className:"rule-middle"},l.a.createElement("div",{className:"rule-title"},l.a.createElement("div",{className:"rule-title-middle"},l.a.createElement("div",{className:"wrap"},t.pannelTab.slice(0,6).map((function(e){return l.a.createElement("div",{className:[t.currentRule===e.ruleId?"tab-item-active":"","tab-item"].join(" "),key:e.ruleId,onClick:function(t){O(e.ruleId,t)}},l.a.createElement("span",{title:e.ruleName},e.ruleName),l.a.createElement(f.a,{type:"close",className:"del-title-btn",onClick:function(t){C(e.ruleId,t)}}))}))),l.a.createElement("div",{className:"rule-btn-wrap"},l.a.createElement("div",{className:"btn-add",onClick:function(e){!function(e){e.stopPropagation(),t.pannelTab.findIndex((function(e){return e.ruleId<0}))>-1||a({type:"newTab"})}(e)}}),l.a.createElement("div",{className:"btn-save",onClick:function(e){V(e)}}),l.a.createElement(Z.a,{overlay:function(){return l.a.createElement(ee.a,null,t.pannelTab.map((function(e){return l.a.createElement(ee.a.Item,{key:e.ruleId},l.a.createElement("div",{className:[t.currentRule===e.ruleId?"tab-item-active":"","tab-item"].join(" "),key:e.ruleId,onClick:function(t){O(e.ruleId,t)}},l.a.createElement("span",{title:e.ruleName},e.ruleName)))})))},placement:"bottomRight",trigger:["click"]},l.a.createElement("div",{className:"btn-menu"}))))),l.a.createElement("div",{className:"middle-content",onClick:function(e){!function(e){e.stopPropagation(),t.currentRule>0&&a({type:"overViewRule"})}(e)}},l.a.createElement("div",{className:"conditions"},v.map((function(e,a){return l.a.createElement("div",{className:["item",t.activePropsId==e.conditionId+"_"+a?"current-node-light":""].join(" "),key:a,onClick:function(t){P(e,1,a,t)}},l.a.createElement("div",{className:"left"},l.a.createElement("img",null)),l.a.createElement("div",{className:"right"},l.a.createElement("div",null,l.a.createElement("span",null,e.conditionTypeName,"："),l.a.createElement("span",null,1===e.conditionTypeId?e.conditionOptionName:e.conditionName)),l.a.createElement("div",null,e.conditionExpression)),l.a.createElement(f.a,{type:"close",className:"del-btn",onClick:function(e){w(a,e)}}))}))),l.a.createElement("div",{className:"logic"},m.map((function(e,a){return l.a.createElement("div",{className:["item",t.activePropsId==e.title?"current-node-light":""].join(" "),key:a,onClick:function(t){P(e,2,a,t)}},l.a.createElement("div",{className:"left"},l.a.createElement("img",null)),l.a.createElement("div",{className:"right"},l.a.createElement("div",null,"逻辑符："),l.a.createElement("div",null,e.title)),l.a.createElement(f.a,{type:"close",className:"del-btn",onClick:function(e){k(e)}}))}))),l.a.createElement("div",{className:"action"},u.map((function(e,a){var n="";return e.actionsId&&e.actionsItems.forEach((function(e){e.actionParamValue.indexOf("clifeai,")>-1?n+=e.deviceFunctionName+":关联AI;":n+=e.deviceFunctionName+":"+e.functionParamName+";"})),l.a.createElement("div",{className:["item",t.activePropsId==e.actionsId+"_"+a?"current-node-light":""].join(" "),key:a,onClick:function(t){P(e,3,a,t)}},l.a.createElement("div",{className:"left"},l.a.createElement("img",null)),l.a.createElement("div",{className:"right"},l.a.createElement("div",null,l.a.createElement("span",null,"设备动作："),l.a.createElement("span",null,e.deviceTypeName)),l.a.createElement("div",null,n)),l.a.createElement(f.a,{type:"close",className:"del-btn",onClick:function(t){j(e,a,t)}}))})))))}a(1507);function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oe(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ie(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(a),!0).forEach((function(t){ce(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ie(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ce(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ue={sentId:0,pannelTab:[],title:"",showTab:"1",propsId:0,activePropsId:0,theme:"",lastData:{},isCheckSave:!1,getFormData:null,currentRule:0,wholeInfo:{},formDom:{},NodeType:0,relatedAI:0,currentEvent:"",nodeInfo:{},allFactorInfo:[],scenceId:0};function de(e,t){var a=o()(e);switch(t.type){case"overViewRule":return le(le({},a),{},{theme:"Tab",showTab:"2",activePropsId:-1});case"getSceneID":return le(le({},a),{},{scenceId:t.payload});case"callBackEvent":return le(le({},a),{},{currentEvent:""});case"reRule":return le(le({},a),{},{pannelTab:t.payload,theme:"Tab"});case"delRule":return a.pannelTab.splice(t.payload.index,1),t.payload.isSame&&(a.currentRule=0),le(le({},a),{},{theme:"Tab",showTab:t.payload.isSame?"1":"2"});case"addReRule":return le(le({},a),{},{pannelTab:t.payload.list,theme:"Tab",currentRule:t.payload.id});case"translateTab":return le(le({},a),{},{theme:"Tab",currentRule:t.payload,showTab:"2"});case"changeNode":return le(le({},a),{},{propsId:t.payload});case"changeTab":return le(le({},a),{},{showTab:t.payload});case"addNode":return le(le({},a),{},{currentEvent:"addNode",nodeInfo:t.payload});case"clickNode":var n;return 1==t.payload.nodeType?n=t.payload.data.conditionId+"_"+t.payload.index:3==t.payload.nodeType?n=t.payload.data.actionsId+"_"+t.payload.index:2==t.payload.nodeType&&(n=t.payload.data.title),le(le({},a),{},{theme:"Node",showTab:"2",currentEvent:"editNode",formDom:t.payload,activePropsId:n});case"setNode":var r=a.pannelTab.find((function(e){return e.tabIndex===a.currentRule}));return 1===t.payload.nodeType&&r.content[t.payload.nodeType-1].push(t.payload),le(le({},a),{},{propsId:t.payload.nodeId});case"transItem":return le(le({},a),{},{showTab:"2",theme:"Node",formDom:t.payload.formDom,propsId:t.payload.nodeId});case"saveItem":return a.formDom.data=le(le({},a.formDom.data),t.payload),le(le({},a),{},{currentEvent:"saveNode"});case"saveActive":return le(le({},a),{},{currentEvent:"reFreshNode"});case"saveWhole":return le(le({},a),{},{wholeInfo:t.payload});case"newTab":return a.pannelTab.push({ruleName:"规则名称",ruleId:-1}),le(le({},a),{},{showTab:"2",theme:"Tab",currentRule:-1});case"saveTab":var i=a.pannelTab.findIndex((function(e){return e.tabIndex===a.currentRule}));return a.pannelTab[i].info=t.payload,le({},a);case"saveCheck":return le(le({},a),{},{getFormData:t.payload});default:return a}}var se=l.a.createContext();function me(e){var t=re(Object(i.useReducer)(de,ue),2),a=t[0],r=t[1],o=re(Object(i.useState)(!1),2),c=o[0],u=o[1],d=Object(i.useMemo)((function(){return console.log(e,"啧啧啧",e.location.pathname.split("/").slice(-1)[0]),e.location.pathname.split("/").slice(-1)[0]}),[]);return d?(Object(i.useEffect)((function(){g(d).then((function(e){0==e.data.code&&r({type:"reRule",payload:e.data.data})}))}),[]),Object(i.useEffect)((function(){(a.activePropsId||a.currentRule)&&(u(!0),setTimeout((function(){u(!1)}),1e3))}),[a.activePropsId,a.currentRule]),l.a.createElement("div",null,l.a.createElement(n.a,{spinning:c},l.a.createElement("div",{className:"rule-configuration"},l.a.createElement(se.Provider,{value:{state:a,dispatch:r,wholeScenceId:d}},l.a.createElement(Y,null),l.a.createElement(ne,null),l.a.createElement(J,null)))))):"无内容"}}}]);